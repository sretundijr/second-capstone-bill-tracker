<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - src/app/create-house.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>src/app/create-house.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">78.49</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">300</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">20.52</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.82</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">const CreateHouseState = require(&#039;./manage-state&#039;);
const Pikaday = require(&#039;pikaday&#039;);
require(&#039;pikaday/css/pikaday.css&#039;);
require(&#039;../styles/create-house.css&#039;);
const HouseHold = require(&#039;./mock-model&#039;);
const { saveHouseHold, createDemoHouse } = require(&#039;./api&#039;);
/* global document, window, location */

const state = new CreateHouseState();

const renderHouseName = () =&gt; {
  const houseHoldName = document.getElementById(&#039;household-name&#039;);
  if (state.getHouseName() !== &#039;&#039;) {
    houseHoldName.value = state.getHouseName();
  }
};

// roommate rendered and saved to state
const roommateHtml = (roommate, index) =&gt; `&lt;li class=&quot;rendered-list&quot;&gt;${roommate.name} 
                &lt;button class=&quot;btn btn-sm btn-primary delete-btn-js rendered-roommate-btn&quot; id=&quot;roommate-${index}&quot;&gt;Delete&lt;/button&gt;
            &lt;/li&gt;`;

const renderRoommateList = () =&gt; {
  const roommateContainer = document.getElementById(&#039;add-roommate&#039;);
  roommateContainer.innerHTML = listToString(state.getRoommates(), roommateHtml);
  document.getElementById(&#039;add-roommate-form&#039;).reset();

  watchDeleteRoommate();
};

const watchRoommateBtn = () =&gt; {
  const addRoommateBtn = document.getElementById(&#039;add-roommate-form&#039;);

  addRoommateBtn.addEventListener(&#039;submit&#039;, (e) =&gt; {
    e.preventDefault();
    const value = document.getElementsByName(&#039;create-roommate&#039;)[0].value;

    state.addRoommate(value);

    render();
  });
};

let watchDeleteRoommate = () =&gt; {
  const deleteBtn = document.getElementsByClassName(&#039;delete-btn-js&#039;);
  const trimIdString = 9;

  Array.from(deleteBtn).forEach((item) =&gt; {
    item.addEventListener(&#039;click&#039;, (e) =&gt; {
      const index = e.target.id.substring(trimIdString);
      state.removeRoommate(index);
      render();
    });
  });
};

// ***************************************************************
// used in both expense and roommate render
let listToString = (list, callback) =&gt; {
  const newList = list.map((item, index) =&gt; callback(item, index));
  return newList.join(&#039;&#039;);
};

// *******************************************
// expenses rendered and saved to state
const partialExpenseTableHtml = () =&gt; `&lt;div class=&quot;expense-table-container&quot;&gt;
                &lt;table class=&quot;table table-condensed&quot;&gt;
                    &lt;thead&gt;
                        &lt;tr&gt;
                            &lt;th&gt;Name&lt;/th&gt;
                            &lt;th&gt;Amount&lt;/th&gt;
                            &lt;th&gt;Due Date&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody id=&quot;expense-table&quot;&gt;

                    &lt;/tbody&gt;
                &lt;/table&gt;
            &lt;/div&gt;`;

const expenseTableHtml = (expense, index) =&gt; `&lt;tr&gt;
                &lt;td&gt;${expense.name}&lt;/td&gt;
                &lt;td&gt;${expense.amount}&lt;/td&gt;
                &lt;td&gt;${expense.dueDate}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&quot;btn btn-sm btn-primary delete-expense-btn-js&quot; id=&quot;expense-${index}&quot;&gt;Delete&lt;/button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;`;

const renderExpenseTable = () =&gt; {
  const tableContainer = document.getElementById(&#039;table-container&#039;);

  if (state.getExpenses().length &gt;= 1) {
    tableContainer.innerHTML = partialExpenseTableHtml();
    const expenseTable = document.getElementById(&#039;expense-table&#039;);
    expenseTable.innerHTML = listToString(state.getExpenses(), expenseTableHtml);
    document.getElementById(&#039;add-expense-form&#039;).reset();

    watchDeleteExpenseBtn();
  } else {
    tableContainer.innerHTML = &#039;&#039;;
  }
};

const watchExpenseBtn = () =&gt; {
  const addBillBtn = document.getElementById(&#039;add-expense-form&#039;);
  const picker = new Pikaday({ field: document.querySelector(&#039;[name=dueDate]&#039;) });

  addBillBtn.addEventListener(&#039;submit&#039;, (e) =&gt; {
    e.preventDefault();

    const expenseObject = {
      name: e.target.name.value,
      dueDate: e.target.dueDate.value,
      amount: e.target.amount.value,
    };

    state.addExpenseToState(expenseObject);
    const mobile = &#039;expenses&#039;;
    render(mobile);
  });
};

let watchDeleteExpenseBtn = () =&gt; {
  const deleteBtn = document.getElementsByClassName(&#039;delete-expense-btn-js&#039;);
  const trimIdString = 8;
  Array.from(deleteBtn).forEach((item) =&gt; {
    item.addEventListener(&#039;click&#039;, (e) =&gt; {
      const index = e.target.id.substring(trimIdString);
      state.removeExpense(index);
      render();
    });
  });
};

// ****************************************
// rendering for household submission
const submitHtml = () =&gt; `&lt;button class=&quot;btn btn-primary&quot; id=&quot;submit-household-btn&quot;&gt;
                Submit Houshold
            &lt;/button&gt;`;

const watchSubmitHousehold = () =&gt; {
  const submitHouseBtn = document.getElementById(&#039;submit-household-btn&#039;);
  submitHouseBtn.addEventListener(&#039;click&#039;, (e) =&gt; {
    const householdName = document.getElementById(&#039;household-name&#039;);
    state.setHouseName(householdName.value);

    saveHouseHold(state.getHouseHold());

    location.href = &#039;/house-stats&#039;;
  });
};

const renderSubmitHousehold = () =&gt; {
  const submitHouseContainer = document.getElementById(&#039;submit-household&#039;);
  submitHouseContainer.innerHTML = &#039;&#039;;
  if (state.readyForSubmit()) {
    submitHouseContainer.innerHTML = submitHtml();
    watchSubmitHousehold();
  }
};

const renderAddRoommateContainer = () =&gt; {
  const roommateRow = document.getElementById(&#039;roommate-row&#039;);
  roommateRow.innerHTML = addRoommateContainerHtml();
};

const addRoommateContainerHtml = () =&gt; `&lt;div id=&quot;roommate-form&quot;&gt; 
            &lt;div class=&quot;col-md-4&quot;&gt;
                &lt;h6 class=&quot;text-center&quot;&gt;Add a Roommate Below&lt;/h6&gt;
                    &lt;div class=&quot;form-container&quot;&gt;
                        &lt;form action=&quot;&quot; id=&quot;add-roommate-form&quot;&gt;
                            &lt;div class=&quot;form-group&quot;&gt;
                                &lt;label class=&quot;control-label&quot; for=&quot;create-roommate&quot;&gt;Roommate&lt;/label&gt;
                                &lt;input class=&quot;form-control input-style&quot; type=&quot;text&quot; name=&quot;create-roommate&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;row&quot;&gt;
                                &lt;div class=&quot;col-md-6&quot;&gt;
                                    &lt;div class=&quot;form-group&quot;&gt;
                                        &lt;input id=&quot;add-roommate-btn input-style&quot; name=&quot;create-roommate&quot; class=&quot;btn btn-primary&quot; type=&quot;submit&quot; value=&quot;Save&quot;&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/form&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;col-md-6 rendered-area&quot;&gt;
                    &lt;h5&gt;Roommates&lt;/h5&gt;
                    &lt;hr&gt;
                    &lt;ol id=&quot;add-roommate&quot;&gt;
                    &lt;/ol&gt;
                &lt;/div&gt;
            &lt;/div&gt;`;

const renderAddExpenseContainer = () =&gt; {
  const addExpenseRow = document.getElementById(&#039;add-expense-row&#039;);
  addExpenseRow.innerHTML = addExpenseContainerHtml();
};

const addExpenseContainerHtml = () =&gt; `&lt;div id=&quot;expense-form&quot;&gt;
            &lt;div class=&quot;col-md-4&quot;&gt;
                &lt;h6 class=&quot;text-center&quot;&gt;Enter a new Expense below&lt;/h6&gt;
                    &lt;div class=&quot;form-container&quot;&gt;
                        &lt;form action=&quot;&quot; id=&quot;add-expense-form&quot;&gt;
                            &lt;div class=&quot;form-group&quot;&gt;
                                &lt;label class=&quot;control-label&quot; for=&quot;name&quot;&gt;Name&lt;/label&gt;
                                &lt;input class=&quot;form-control input-style&quot; type=&quot;text&quot; name=&quot;name&quot; placeholder=&quot;electric&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;form-group&quot;&gt;
                                &lt;label class=&quot;control-label&quot; for=&quot;due-date&quot;&gt;Due Date&lt;/label&gt;
                                &lt;input class=&quot;form-control input-style&quot; type=&quot;text&quot; name=&quot;dueDate&quot; placeholder=&quot;MM/DD/YYYY&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;form-group&quot;&gt;
                                &lt;label class=&quot;control-label&quot; for=&quot;amount&quot;&gt;Amount&lt;/label&gt;
                                &lt;input class=&quot;form-control input-style&quot; type=&quot;text&quot; name=&quot;amount&quot; placeholder=&quot;100.32&quot;&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;row&quot;&gt;
                                &lt;div class=&quot;col-md-6&quot;&gt;
                                    &lt;div class=&quot;form-group&quot;&gt;
                                        &lt;input id=&quot;expense-btn&quot; name=&quot;create-expense&quot; class=&quot;btn btn-primary input-style&quot; type=&quot;submit&quot; value=&quot;Save&quot;&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/form&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;row&quot;&gt;
                    &lt;div class=&quot;col-md-6&quot;&gt;
                        &lt;div class=&quot;rendered-area&quot;&gt;
                            &lt;h5&gt;Expenses&lt;/h5&gt;
                            &lt;hr&gt;
                        &lt;/div&gt;
                        &lt;div id=&quot;table-container&quot;&gt;

                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;`;

// mobile rendering
const mobileNavButtonsHtml = () =&gt; `&lt;button id=&quot;add-roommates-btn&quot; class=&quot;btn btn-primary&quot; type=&quot;button&quot;&gt;Add Roommates&lt;/button&gt;
            &lt;button id=&quot;add-expenses-btn&quot; class=&quot;btn btn-primary&quot; type=&quot;button&quot;&gt;Add Expenses&lt;/button&gt;`;

const renderMobileNav = () =&gt; {
  const mobileNavRenderArea = document.getElementById(&#039;mobile-nav-render-area&#039;);
  mobileNavRenderArea.innerHTML = mobileNavButtonsHtml();
};

const watchAddRoommatesBtn = () =&gt; {
  const addRoommates = document.getElementById(&#039;add-roommates-btn&#039;);
  addRoommates.addEventListener(&#039;click&#039;, () =&gt; {
    const addExpenses = document.getElementById(&#039;expense-form&#039;);
    addExpenses.parentNode.removeChild(addExpenses);
    render();
  });
};

const watchAddExpensesBtn = () =&gt; {
  const addExpenses = document.getElementById(&#039;add-expenses-btn&#039;);
  addExpenses.addEventListener(&#039;click&#039;, () =&gt; {
    const addRoommate = document.getElementById(&#039;roommate-form&#039;);
    addRoommate.parentNode.removeChild(addRoommate);
    const mobile = &#039;expenses&#039;;
    render(mobile);
  });
};

// check calls to mobile, refactor this
let render = (mobile = &#039;&#039;) =&gt; {
  if (window.innerWidth &lt;= &#039;1000&#039;) {
    renderMobileNav();
    watchAddRoommatesBtn();
    watchAddExpensesBtn();
    if (mobile === &#039;expenses&#039;) {
      renderAddExpenseContainer();
      renderExpenseTable();
      watchExpenseBtn();
    } else {
      renderAddRoommateContainer();
      renderRoommateList();
      watchRoommateBtn();
    }
    renderHouseName();
    renderSubmitHousehold();
  } else {
    renderAddExpenseContainer();
    renderAddRoommateContainer();
    renderRoommateList();
    renderExpenseTable();
    renderSubmitHousehold();
    renderHouseName();
    watchRoommateBtn();
    watchExpenseBtn();
  }
};

document.addEventListener(&#039;DOMContentLoaded&#039;, () =&gt; {
  state.setHouseHold(createDemoHouse());
  render();
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
